<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Practice</title>
    <style>
body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #141010;
    color: white;
    font-family: Arial, sans-serif;
    flex-direction: column;
    text-align: center;
    position: relative;
}

.stats-container {
    position: absolute;
    top: 80px;
    right: 100px;
    font-size: 18px;
    background: rgba(0, 0, 0, 0.6);
    padding: 10px 15px;
    border-radius: 8px;
}

.controls {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

select {
    padding: 8px 15px;
    border: 2px solid #5a189a;
    border-radius: 5px;
    background-color: #240046;
    color: white;
    font-size: 16px;
    cursor: pointer;
    outline: none;
}

select:hover {
    background-color: #3c096c;
}

button {
    padding: 8px 20px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    background-color: #7b2cbf;
    color: white;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    background-color: #9d4edd;
}

.input-container {
    position: relative;
    width: 100vw;
    max-width: 3000px;
    height: 50vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.background-text {
    position: absolute;
    width: 100%;
    height: 100%;
    font-size: 22px;
    padding: 20px;
    color: rgba(255, 255, 255, 0.3);
    white-space: pre-wrap;
    word-wrap: break-word;
    text-align: left;
    font-family: inherit;
    line-height: 1.5;
    z-index: 1;
}

.input-box {
    position: absolute;
    width: 100%;
    height: 100%;
    font-size: 22px;
    padding: 20px;
    border: none;
    background: transparent;
    color: transparent;
    outline: none;
    resize: none;
    z-index: 2;
    caret-color: white;
    text-align: left;
    font-family: inherit;
    line-height: 1.5;
}

.correct {
    color: white;
}

.incorrect {
    color: red;
}

#popup-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    z-index: 1000;
}

.popup-content h2 {
    margin: 0 0 10px;
}

.popup-content p {
    margin: 5px 0;
}

#close-popup {
    margin-top: 10px;
    padding: 8px 20px;
    border: none;
    border-radius: 5px;
    background-color: #7b2cbf;
    color: white;
    cursor: pointer;
    transition: 0.3s;
}

#close-popup:hover {
    background-color: #9d4edd;
}

/* Heading Styling */
.heading {
    font-size: 28px;
    font-weight: bold;
    color: white;
    margin-top: 40px;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    padding: 10px 0;
}

/* Footer Styling */
#footer-container {
    width: 100%;
    margin-bottom: 100px;
}

footer {
    background-color: rgba(128, 128, 128, 0.5);
    color: black;
    text-align: center;
    padding: 15px;
    position: fixed;
    bottom: 0;
    left: -20px;
    width: 100%;
    opacity: 0;
    backdrop-filter: blur(8px);
    font-size: 16px;
    transition: opacity 0.5s ease-in-out;
}
@import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Kannada&display=swap');

body {
    font-family: 'Noto Sans Kannada', sans-serif;
}
@media (max-width: 768px) {
    /* General Layout */
    body, html {
        padding: 10px;
        height: auto;
        justify-content: flex-start; /* Allow scrolling */
    }

    /* Stats Container */
    .stats-container {
        position: static; /* Remove absolute positioning */
        top: 0;
        right: 0;
        font-size: 14px;
        background: rgba(0, 0, 0, 0.6);
        padding: 8px 12px;
        border-radius: 6px;
        margin-bottom: 10px;
    }

    /* Controls */
    .controls {
        flex-direction: column; /* Stack items vertically */
        gap: 10px;
    }

    select, button {
        width: 100%; /* Make inputs and buttons full-width */
        padding: 10px 15px;
        font-size: 14px;
        margin: 5px 0;
    }

    /* Input Container */
    .input-container {
        width: 100%;
        height: 40vh;
        max-width: 100%;
    }

    .background-text, .input-box {
        font-size: 18px;
        padding: 15px;
    }

    /* Heading */
    .heading {
        font-size: 24px;
        margin-top: 20px;
        margin-bottom: 15px;
    }

    /* Popup */
    #popup-message {
        width: 90%;
        padding: 15px;
    }

    /* Footer */
    footer {
        font-size: 14px;
        padding: 10px;
    }

    /* Fix footer visibility */
    #footer-container {
        margin-bottom: 50px; /* Ensure footer doesn't overlap content */
    }

    .popup-content h2 {
        font-size: 18px;
    }

    .popup-content p {
        font-size: 14px;
    }

    #close-popup {
        padding: 8px 15px;
    }
}

    </style>
</head>
<body>
     <!-- Help Button -->
<button class="faq-button" onclick="showHelp()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
        <path d="M80 160c0-35.3 28.7-64 64-64h32c35.3 0 64 28.7 64 64v3.6c0 21.8-11.1 42.1-29.4 53.8l-42.2 27.1c-25.2 16.2-40.4 44.1-40.4 74V320c0 17.7 14.3 32 32 32s32-14.3 32-32v-1.4c0-8.2 4.2-15.8 11-20.2l42.2-27.1c36.6-23.6 58.8-64.1 58.8-107.7V160c0-70.7-57.3-128-128-128H144C73.3 32 16 89.3 16 160c0 17.7 14.3 32 32 32s32-14.3 32-32zm80 320a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"></path>
    </svg>
    <span class="tooltip">Need help</span>
</button>

<!-- Overlay -->
<div id="overlay" onclick="hideHelp()"></div>
<!-- Help Image Modal -->
<div id="helpImage" onclick="event.stopPropagation()">
    <button class="close-btn" onclick="hideHelp()">X</button>
    <img src="http://ka-naada.in/wp-content/uploads/2025/04/sticker2.jpg" alt="logo" style="width: 100%;">
</div>


    <!-- Load Header Here -->
    <div id="header-container"></div>
    <div class="stats-container">
        <div id="timer-display">Time: 0s</div>
    </div>
    
    <div class="controls">
        <select id="timer-select">
            <option value="120">2 min</option>
            <option value="60">1 min</option>
            <option value="40">40 sec</option>
        </select>
        
        <button id="start-button">Start</button>
    </div>

    <div class="input-container">
        <div id="background-text" class="background-text"></div>
        <textarea id="typing-input" class="input-box"></textarea>

    </div>

    <!-- Footer Container -->
    <div id="footer-container"></div>
    <script>
         // Function to Load External HTML Files
         function loadComponent(elementId, filePath) {
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                })
                .catch(error => console.error('Error loading component:', error));
        }

        // Load header.html and footer.html
        loadComponent("header-container", "header.html");
        loadComponent("footer-container", "footer.html");

        // Footer Scroll Effect
        let lastScrollY = window.scrollY;
        
        window.addEventListener("scroll", function () {
            let footer = document.querySelector("footer");
            let currentScrollY = window.scrollY;

            if (currentScrollY > lastScrollY) {  
                // Show footer when scrolling down
                footer.style.opacity = "1";
            } else {  
                // Hide footer when scrolling up
                footer.style.opacity = "0";
            }

            lastScrollY = currentScrollY;
        });

        // Show footer after 2 seconds on page load
        setTimeout(() => {
            let footer = document.querySelector("footer");
            if (footer) {
                footer.style.opacity = "1";
            }
        }, 1000);

        function showHelp() {
            document.getElementById("helpImage").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }

        function hideHelp() {
            document.getElementById("helpImage").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
        const paragraphs = [
    "ಸೂರ್ಯನು ಪರ್ವತಗಳ ಹಿಂದೆ ಅಸ್ತವಾಗುತ್ತಿದ್ದಾಗ, ಕಣಿವೆಯ ಮೇಲೆ ಬಂಗಾರದ ಕಂಚಿನಂತೆ ಬೆಳಕು ಹರಡಿತು. ಪಕ್ಷಿಗಳು ದಿನದ ಕೊನೆಯ ಹಾಡುಗಳನ್ನು ಹಾಡುತ್ತಿದ್ದವು, ಶೀತಳ ಗಾಳಿ ಹಳೆಯ ಮರಗಳ ಎಲೆಗಳನ್ನು ಸಡಸರಿಸುತ್ತಿತ್ತು. ಇದು ಒಂದು ಶಾಂತ ಸಾಯಂಕಾಲವಾಗಿತ್ತು, ಪ್ರಕೃತಿಯ ಸೌಂದರ್ಯವನ್ನು ಮೆಚ್ಚುವಂತೆ ಮಾಡುವಂತಹ ಸಮಯ. ಆಕಾಶವು ಗುಲಾಬಿ ಮತ್ತು ಕಿತ್ತಳೆ ಬಣ್ಣಗಳಿಗೆ ತಿರುಗಿದಂತೆ, ಶಾಂತಿಯ ಭಾವನೆ ಭೂಮಿಯ ಮೇಲೆ ಹರಡಿತು.",
    "ತಂತ್ರಜ್ಞಾನವು ನಮ್ಮ ಜೀವನ ಶೈಲಿಯನ್ನು ಮತ್ತು ಜಗತ್ತಿನೊಂದಿಗೆ ನಮ್ಮ ಸಂವಹನವನ್ನು ಬದಲಾಯಿಸಿದೆ. ಸ್ಮಾರ್ಟ್‌ಫೋನ್‌ಗಳಿಂದ ಕೃತಕ ಬುದ್ಧಿವಂತಿಕೆವರೆಗೆ, ನಾವಿನ್ಯತೆಗಳು ಪ್ರತಿದಿನ ನಮ್ಮ ಜೀವನವನ್ನು ರೂಪಿಸುತ್ತಿವೆ. ಜನರು ವಿಶ್ವದಾದ್ಯಂತ ತಕ್ಷಣ ಸಂಪರ್ಕ ಸಾಧಿಸಬಹುದು, ಅನಿಯಮಿತ ಜ್ಞಾನವನ್ನು ಪ್ರವೇಶಿಸಬಹುದು, ಮತ್ತು ಹಿಂದೆ ಗಂಟೆಗಳ ಕಾಲ ತೆಗೆದುಕೊಳ್ಳುತ್ತಿದ್ದ ಕೆಲಸಗಳನ್ನು ಸ್ವಯಂಚಾಲಿತಗೊಳಿಸಬಹುದು. ತಂತ್ರಜ್ಞಾನ ಸುಲಭತೆಯನ್ನು ನೀಡಿದರೂ, ಗೌಪ್ಯತೆ, ಭದ್ರತೆ, ಮತ್ತು ಮಾನವ ಸಂಪರ್ಕದ ಕುರಿತು ಪ್ರಶ್ನೆಗಳನ್ನು ಹುಟ್ಟಿಸುತ್ತದೆ.",
    "ಒಂದು ಒಳ್ಳೆಯ ಪುಸ್ತಕವು ಓದುಗರನ್ನು ವಿಭಿನ್ನ ಜಗತ್ತಿಗೆ ಒಯ್ಯುವ ಶಕ್ತಿ ಹೊಂದಿದೆ. ಇದು ಒಂದು ರೋಮಾಂಚಕ ಸಾಹಸವಾಗಲಿ, ಮನಮಿಡಿಯುವ ಪ್ರೀತಿ ಕಥೆಯಾಗಲಿ, ಅಥವಾ ಆಲೋಚನೆಗೆ ಪ್ರೇರೇಪಿಸುವ ಅದ್ಭುತ ಕತೆ ಆಗಿರಲಿ, ಕಥೆಗಳು ನಮ್ಮ ಮನಸ್ಸನ್ನು ಆಕರ್ಷಿಸುತ್ತವೆ. ಓದುವುದರಿಂದ ಜನರು ಹೊಸ ದೃಷ್ಟಿಕೋಣಗಳನ್ನು ಅನ್ವೇಷಿಸಬಹುದು, ವಿಭಿನ್ನ ಸಂಸ್ಕೃತಿಗಳನ್ನು ತಿಳಿಯಬಹುದು, ಮತ್ತು ಸಹಾನುಭೂತಿಯುಳ್ಳ ವ್ಯಕ್ತಿಗಳಾಗಬಹುದು. ಪುಸ್ತಕಗಳು ಕೇವಲ ಅಕ್ಷರಗಳ ಪುಟಗಳು ಅಲ್ಲ; ಅವು ಕಲ್ಪನೆಯ ಕಿಟಕಿಗಳು.",
    "ಯಶಸ್ಸು ಸದಾ ಪ್ರತಿಭೆಯ ಮೇಲೆ ಅಥವಾ ಬುದ್ಧಿವಂತಿಕೆಗೆ ಮಾತ್ರ ಅವಲಂಬಿತವಿರುವುದಿಲ್ಲ; ಅದನ್ನು ಸಾಧಿಸಲು ಸಂಕಲ್ಪ ಬಹಳ ಮುಖ್ಯ. ಅನೇಕ ಮಹಾನ್ ಸಾಧಕರಿಗೆ ಗುರಿ ತಲುಪುವ ಮೊದಲು ವಿಫಲತೆಯ ಅನುಭವವಿದೆ. ಆದರೆ ಅವರನ್ನು ವಿಭಿನ್ನಗೊಳಿಸುವುದು ಅವರ ನಿರ್ಧಾರಶೀಲತೆ ಮತ್ತು ಶ್ರದ್ಧೆ. ಕಠಿಣ ಕೆಲಸ, ಸಹನಶೀಲತೆ, ಮತ್ತು ಸಕಾರಾತ್ಮಕ ಮನೋಭಾವವು ಸವಾಲುಗಳನ್ನು ಅವಕಾಶಗಳಾಗಿ ಪರಿವರ್ತಿಸಬಹುದು. ಕೊನೆಗೆ, ಏನಾಗಲೀ ಯತ್ನಿಸುವವರೇ ನಿಜವಾಗಿಯೂ ಯಶಸ್ವಿಯಾಗುತ್ತಾರೆ.",
    "ನಮ್ಮ ಪರಿಸರವನ್ನು ಕಾಪಾಡುವುದು ನಮ್ಮೆಲ್ಲರ ಜವಾಬ್ದಾರಿ. ಪರಿಸರ ಮಾಲಿನ್ಯ, ಹಾನಿಗೊಳಗಾಗುತ್ತಿರುವ ವನ್ಯಜೀವಿಗಳು, ಮತ್ತು ಹಸಿರು ಪ್ರದೇಶಗಳ ನಾಶದಿಂದಾಗಿ ಪ್ರಕೃತಿ ತೀವ್ರ ಹಾನಿಗೊಳ್ಳುತ್ತಿದೆ. ಈ ಪರಿಸ್ಥಿತಿಯನ್ನು ಸುಧಾರಿಸಲು, ಮರಗಳನ್ನು ನೆಡುವುದು, ನೈಸರ್ಗಿಕ ಸಂಪತ್ತುಗಳನ್ನು ಸಂರಕ್ಷಿಸುವುದು, ಮತ್ತು ಪ್ಲಾಸ್ಟಿಕ್ ಬಳಕೆಯನ್ನು ಕಡಿಮೆ ಮಾಡುವುದು ಅಗತ್ಯ. ಪ್ರತಿ ವ್ಯಕ್ತಿಯೂ ತನ್ನ ಸ್ವಲ್ಪ ಪ್ರಯತ್ನದಿಂದಲೂ ಭೂಮಿಯನ್ನು ಸುಂದರ ಮತ್ತು ಆರೋಗ್ಯಕರವಾಗಿ ಉಳಿಸಬಹುದು.",
    "ಸಂಸ್ಕೃತಿ ಮತ್ತು ಪರಂಪರೆ ನಮ್ಮ ಗುರುತಿನ ಮಹತ್ವದ ಭಾಗವಾಗಿದೆ. ಪ್ರತಿಯೊಬ್ಬ ವ್ಯಕ್ತಿಯ ಜೀವನದಲ್ಲಿ, ಅವರ ಸಂಸ್ಕೃತಿ ಅವರನ್ನು ನಂಬಿಕೆಗಳು, ಆಚರಣೆಗಳು, ಮತ್ತು ಮೌಲ್ಯಗಳ ಮೂಲಕ ಪ್ರಭಾವಿತಗೊಳಿಸುತ್ತದೆ. ಸಂಸ್ಕೃತಿಯು ಕೇವಲ ಪುರಾತನ ಆಚರಣೆಗಳ ಸಂಗ್ರಹವಲ್ಲ; ಅದು ನಾವು ಇಂದು ಇರುವುದಕ್ಕೆ ಕಾರಣವಾಗಿರುವ ಜೀವನಪದ್ದತಿಯ ಸಮ್ಮಿಶ್ರಣವಾಗಿದೆ. ನಮ್ಮ ಸಂಸ್ಕೃತಿಯನ್ನು ಗೌರವಿಸುವುದು ಮತ್ತು ಮುಂದಿನ ಪೀಳಿಗೆಗೆ ಸಾಗಿಸುವುದು ನಮ್ಮ ಕರ್ತವ್ಯವಾಗಿದೆ.",
    "ಸ್ನೇಹ ಜೀವಿತದಲ್ಲಿ ಅಮೂಲ್ಯವಾದ ಸಂಬಂಧ. ಒಳ್ಳೆಯ ಸ್ನೇಹಿತರು ನಮ್ಮನ್ನು ಪ್ರೇರೇಪಿಸುತ್ತಾರೆ, ನಮ್ಮ ಸಂತೋಷವನ್ನು ಹಂಚಿಕೊಳ್ಳುತ್ತಾರೆ, ಮತ್ತು ದುಃಖದಲ್ಲಿ ನಮ್ಮೊಂದಿಗೆ ನಿಂತುಕೊಳ್ಳುತ್ತಾರೆ. ನಂಬಿಕೆ, ಪರಸ್ಪರ ಗೌರವ, ಮತ್ತು ಪ್ರಾಮಾಣಿಕತೆ ಉತ್ತಮ ಸ್ನೇಹವನ್ನು ರೂಪಿಸಲು ಅಗತ್ಯ. ನಿಜವಾದ ಸ್ನೇಹ ಜೀವನದ ಜಟಿಲ ಪರಿಸ್ಥಿತಿಗಳನ್ನು ಸರಳಗೊಳಿಸಬಲ್ಲ ಶಕ್ತಿಯನ್ನು ಹೊಂದಿದೆ. ಏಕೆಂದರೆ, ಸ್ನೇಹ ಎಂಬುದು ಕೇವಲ ಮನಸ್ಸಿನ ಒಡನಾಟವಲ್ಲ, ಹೃದಯದ ಬಂಧವೂ ಹೌದು.",
    "ಕಲೆ ಮತ್ತು ಸಂಗೀತವು ನಮ್ಮ ಭಾವನೆಗಳನ್ನು ವ್ಯಕ್ತಗೊಳಿಸಲು ಶಕ್ತಿಯುತವಾದ ಮಾಧ್ಯಮಗಳು. ಉತ್ತಮ ಚಿತ್ರಕಲೆ, ಕಾವ್ಯ, ನೃತ್ಯ, ಅಥವಾ ಸಂಗೀತ ಕೃತಿಗಳು ಮಾನವ ಮನಸ್ಸಿಗೆ ಆನಂದವನ್ನು ಮತ್ತು ಪ್ರೇರಣೆಯನ್ನು ನೀಡುತ್ತವೆ. ಕಲೆ ಕೇವಲ ವೀಕ್ಷಿಸಲು ಅಥವಾ ಆಲಿಸಲು ಮಾತ್ರವಲ್ಲ; ಅದು ಒಳಗಿನ ಭಾವನೆಗಳನ್ನು ವ್ಯಕ್ತಗೊಳಿಸುವ ಸಾಧನವಾಗಿದೆ. ಸಂಗೀತ ಮತ್ತು ಕಲೆಗಳು ಸಮಾಜವನ್ನು ಹೊಂದಿಸುವ ಸಾಮರ್ಥ್ಯವನ್ನು ಹೊಂದಿದ್ದು, ಜನರನ್ನು ಒಂದಾಗಿ ತರುವ ಶಕ್ತಿ ಹೊಂದಿವೆ.",
    "ಅಹಂ ಮತ್ತು ಅಹಂಕಾರವು ವ್ಯಕ್ತಿಯ ಜೀವನದಲ್ಲಿ ಅಪಾಯಕಾರಿಗಳು. ಒಬ್ಬ ವ್ಯಕ್ತಿಯು ತನ್ನ ಸಾಧನೆಗಳ ಬಗ್ಗೆ ಗರ್ವಿಸಲು ತಪ್ಪಿಲ್ಲ, ಆದರೆ ಅತಿಯಾದ ಅಹಂಕಾರವು ಸಂಬಂಧಗಳನ್ನು ಹಾಳುಮಾಡಬಹುದು. ವಿನಯವು ವ್ಯಕ್ತಿಯ ಶಕ್ತಿಯನ್ನೇ ಹೆಚ್ಚಿಸುತ್ತದೆ, ಮತ್ತು ಸೌಜನ್ಯವು ಹೆಚ್ಚು ಜನರನ್ನು ಸೆಳೆಯುತ್ತದೆ. ಪರಸ್ಪರ ಗೌರವ, ಸಾತ್ವಿಕತೆ, ಮತ್ತು ಆತ್ಮನಿಯಂತ್ರಣ ಜೀವನದಲ್ಲಿ ಶ್ರೇಷ್ಠತೆಯನ್ನು ತಲುಪಲು ಸಹಾಯಕವಾಗಬಲ್ಲವು.",
    "ಆರೋಗ್ಯವೇ ಸಂಪತ್ತು ಎಂದು ಹೇಳುವುದು ಖಂಡಿತ ಸತ್ಯ. ದೈನಂದಿನ ವ್ಯಾಯಾಮ, ಸರಿಯಾದ ಆಹಾರ ಕ್ರಮ, ಮತ್ತು ಮಾನಸಿಕ ಶಾಂತಿ ನಮ್ಮ ಆರೋಗ್ಯವನ್ನು ಉತ್ತಮಗೊಳಿಸುತ್ತವೆ. ಆರೋಗ್ಯಕರ ಜೀವನಶೈಲಿಯಿಂದ ಮಾತ್ರ ದೀರ್ಘಾಯುಷ್ಯವನ್ನು ನಿರೀಕ್ಷಿಸಬಹುದು. ಜಾಗೃತ ಮನಸ್ಸು, ತಂಪಾದ ಹೃದಯ, ಮತ್ತು ಶಕ್ತಿಯುತ ಶರೀರವು ಜೀವನವನ್ನು ಆನಂದಿಸಲು ಸಹಾಯ ಮಾಡುತ್ತದೆ. ಆದುದರಿಂದ, ನಾವು ನಮ್ಮ ದೇಹದ ಮತ್ತು ಮನಸ್ಸಿನ ಆರೋಗ್ಯವನ್ನು ಸಮರ್ಪಕವಾಗಿ ಕಾಪಾಡಿಕೊಳ್ಳಬೇಕು."
];
let selectedParagraph = "";
const backgroundText = document.getElementById("background-text");
const inputBox = document.getElementById("typing-input");
const timerDisplay = document.getElementById("timer-display");
const timerSelect = document.getElementById("timer-select");
const startButton = document.getElementById("start-button");

let startTime = null;
let totalTyped = 0;
let correctTyped = 0;
let countdown = 0;
let timer = null; // Keep only one timer declaration
let timeLeft = 10; // Default time (changeable)
let isRunning = false; // Track if timer is running



function getRandomParagraph() {
    return paragraphs[Math.floor(Math.random() * paragraphs.length)];
}

function updateBackgroundText() {
    let userText = inputBox.value;
    let formattedText = "";
    let cleanedUserText = userText.replace(/\s+/g, ''); // Remove spaces for comparison
    let cleanedParagraph = selectedParagraph.replace(/\s+/g, '');

    // ⏳ Start the timer ONLY when the user types the first character
    if (!startTime && cleanedUserText.length > 0) {
        startTime = new Date().getTime();
        if (!isRunning) {
            isRunning = true;
            startTimer();  // 🔥 Start the timer when the first character is typed
        }
    }

    let inputIndex = 0;
    for (let i = 0; i < selectedParagraph.length; i++) {
        if (selectedParagraph[i] === " ") {
            formattedText += " ";
        } else {
            if (inputIndex < cleanedUserText.length) {
                totalTyped++;
                if (cleanedUserText[inputIndex] === cleanedParagraph[inputIndex]) {
                    formattedText += `<span class="correct">${selectedParagraph[i]}</span>`;
                    correctTyped++;
                } else {
                    formattedText += `<span class="incorrect">${selectedParagraph[i]}</span>`;
                }
                inputIndex++;
            } else {
                formattedText += selectedParagraph[i];
            }
        }
    }

    backgroundText.innerHTML = formattedText;
    inputBox.setSelectionRange(userText.length, userText.length);

    // ✅ If user finishes typing before time runs out, stop the timer and show results
    if (cleanedUserText === cleanedParagraph) {
        clearInterval(timer);
        const currentTime = new Date().getTime();
        const timeTaken = startTime ? Math.floor((currentTime - startTime) / 1000) : 0;
        endTest(true, timeTaken);
    }
}
// Preload the beep sound
const beep = new Audio("beep3.mp3");
beep.load();


timerSelect.addEventListener("change", function () {
    let newTime = parseInt(timerSelect.value);

    if (!isRunning) {
        // If the test has not started, update countdown
        countdown = newTime;
        timerDisplay.innerText = `Time: ${countdown}s`;
    } else {
        // ⚠️ Do NOT restart the timer if the test is running!
        let timeElapsed = parseInt(timerSelect.getAttribute("data-start-time")) || 0;
        let remainingTime = newTime - timeElapsed;
        
        if (remainingTime > 0) {
            countdown = remainingTime;
            timerDisplay.innerText = `Time: ${countdown}s`;
        }
    }
});


function startTimer() {
    if (timer) clearInterval(timer); // 🚀 Prevent multiple timers
    timer = setInterval(() => {
        countdown--;
        timerDisplay.innerText = `Time: ${countdown}s`;

        if (countdown === 4) {
            beep.currentTime = 0;
            beep.play().catch(error => console.error("Audio play failed:", error));
        }

        if (countdown <= 0) {
            clearInterval(timer);
            endTest();
        }
    }, 1000);
}

function startTest() {
    selectedParagraph = getRandomParagraph();
    backgroundText.innerHTML = selectedParagraph;

    countdown = parseInt(timerSelect.value);
    timerDisplay.innerText = `Time: ${countdown}s`;
    inputBox.value = "";
    totalTyped = 0;
    correctTyped = 0;
    startTime = null;
    inputBox.disabled = false;
    inputBox.focus();
    updateBackgroundText();

    startButton.disabled = true;
    isRunning = false; // Make sure typing starts the timer, not button press
}
function calculateAccuracy() {
    let userText = inputBox.value;
    let totalTyped = userText.length;
    let correctTyped = 0;

    for (let i = 0; i < totalTyped; i++) {
        if (userText[i] === selectedParagraph[i]) {
            correctTyped++;
        }
    }

    let accuracy = totalTyped > 0 ? (correctTyped / totalTyped) * 100 : 0;
    return accuracy.toFixed(2); // Limit to 2 decimal places
}


function endTest(completed = false, timeTaken = null) {
    inputBox.disabled = true;
    clearInterval(timer);

    const currentTime = new Date().getTime();
    const elapsedTime = startTime ? (currentTime - startTime) / 60000 : 0; // Convert ms to minutes
    const wordCount = inputBox.value.trim().split(/\s+/).length;
    const wpm = elapsedTime > 0 ? Math.round(wordCount / elapsedTime) : 0;
    const accuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 100;

    // **Fix:** Use the correct time taken when user finishes early
    const displayTimeTaken = completed ? `${timeTaken}s` : `${timerSelect.value}s`;

    // Play beep sound when test ends
    beep.currentTime = 0;
    beep.play().catch(error => console.error("Beep failed to play:", error));

    const popup = document.createElement("div");
    popup.id = "popup-message";
    popup.innerHTML = `
        <div class="popup-content">
            <h2>${completed ? "Congratulations! You finished typing!" : "Time's up!"}</h2>
            <p><strong>WPM:</strong> ${wpm}</p>
            <p><strong>Accuracy:</strong> ${accuracy}%</p>
            <p><strong>Time Taken:</strong> ${displayTimeTaken}</p>
            <button id="close-popup">OK</button>
        </div>
    `;

    document.body.appendChild(popup);

    document.getElementById("close-popup").addEventListener("click", () => {
        popup.remove();
        startButton.disabled = false;
    });

    startButton.disabled = false;
}


inputBox.addEventListener("input", updateBackgroundText);
startButton.addEventListener("click", startTest);

window.onload = () => {
    selectedParagraph = getRandomParagraph();
    backgroundText.innerHTML = selectedParagraph;
    inputBox.focus();
};
 
    </script>

</body>
</html>