<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Typing Practice</title>
    <style>
body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #141010;
    color: white;
    font-family: Arial, sans-serif;
    flex-direction: column;
    text-align: center;
    position: relative;
}

.stats-container {
    position: absolute;
    top: 80px;
    right: 100px;
    font-size: 18px;
    background: rgba(0, 0, 0, 0.6);
    padding: 10px 15px;
    border-radius: 8px;
}

.controls {
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

select {
    padding: 8px 15px;
    border: 2px solid #5a189a;
    border-radius: 5px;
    background-color: #240046;
    color: white;
    font-size: 16px;
    cursor: pointer;
    outline: none;
}

select:hover {
    background-color: #3c096c;
}

button {
    padding: 8px 20px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    background-color: #7b2cbf;
    color: white;
    cursor: pointer;
    transition: 0.3s;
}

button:hover {
    background-color: #9d4edd;
}

.input-container {
    position: relative;
    width: 100vw;
    max-width: 3000px;
    height: 50vh;
    display: flex;
    align-items: center;
    justify-content: center;
}

.background-text {
    position: absolute;
    width: 100%;
    height: 100%;
    font-size: 22px;
    padding: 20px;
    color: rgba(255, 255, 255, 0.3);
    white-space: pre-wrap;
    word-wrap: break-word;
    text-align: left;
    font-family: inherit;
    line-height: 1.5;
    z-index: 1;
}

.input-box {
    position: absolute;
    width: 100%;
    height: 100%;
    font-size: 22px;
    padding: 20px;
    border: none;
    background: transparent;
    color: transparent;
    outline: none;
    resize: none;
    z-index: 2;
    caret-color: white;
    text-align: left;
    font-family: inherit;
    line-height: 1.5;
}

.correct {
    color: white;
}

.incorrect {
    color: red;
}

#popup-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.8);
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    z-index: 1000;
}

.popup-content h2 {
    margin: 0 0 10px;
}

.popup-content p {
    margin: 5px 0;
}

#close-popup {
    margin-top: 10px;
    padding: 8px 20px;
    border: none;
    border-radius: 5px;
    background-color: #7b2cbf;
    color: white;
    cursor: pointer;
    transition: 0.3s;
}

#close-popup:hover {
    background-color: #9d4edd;
}

/* Heading Styling */
.heading {
    font-size: 28px;
    font-weight: bold;
    color: white;
    margin-top: 40px;
    margin-bottom: 20px;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 2px;
    padding: 10px 0;
}

/* Footer Styling */
#footer-container {
    width: 100%;
    margin-bottom: 100px;
}

footer {
    background-color: rgba(128, 128, 128, 0.5);
    color: black;
    text-align: center;
    padding: 15px;
    position: fixed;
    bottom: 0;
    left: -20px;
    width: 100%;
    opacity: 0;
    backdrop-filter: blur(8px);
    font-size: 16px;
    transition: opacity 0.5s ease-in-out;
}
@media (max-width: 768px) {
    .stats-container {
        top: 20px;
        right: 10px;
        font-size: 14px;
        padding: 8px;
    }

    .controls {
        flex-direction: column;
        gap: 5px;
    }

    select {
        width: 100%;
        font-size: 14px;
        padding: 6px 10px;
    }

    button {
        width: 100%;
        font-size: 14px;
        padding: 10px;
    }

    .input-container {
        height: 40vh;
        width: 95%;
    }

    .background-text, .input-box {
        font-size: 16px;
        padding: 15px;
    }

    .heading {
        font-size: 22px;
        margin-top: 20px;
    }

    #popup-message {
        width: 90%;
        padding: 15px;
    }

    footer {
        font-size: 14px;
        padding: 10px;
    }
}


    </style>
</head>
<body>
    

     <!-- Help Button -->
<button class="faq-button" onclick="showHelp()">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512">
        <path d="M80 160c0-35.3 28.7-64 64-64h32c35.3 0 64 28.7 64 64v3.6c0 21.8-11.1 42.1-29.4 53.8l-42.2 27.1c-25.2 16.2-40.4 44.1-40.4 74V320c0 17.7 14.3 32 32 32s32-14.3 32-32v-1.4c0-8.2 4.2-15.8 11-20.2l42.2-27.1c36.6-23.6 58.8-64.1 58.8-107.7V160c0-70.7-57.3-128-128-128H144C73.3 32 16 89.3 16 160c0 17.7 14.3 32 32 32s32-14.3 32-32zm80 320a40 40 0 1 0 0-80 40 40 0 1 0 0 80z"></path>
    </svg>
    <span class="tooltip">Need help</span>
</button>

<!-- Overlay -->
<div id="overlay" onclick="hideHelp()"></div>

<!-- Help Image Modal -->
<div id="helpImage" onclick="event.stopPropagation()">
    <button class="close-btn" onclick="hideHelp()">X</button>
    <img src="http://ka-naada.in/wp-content/uploads/2025/04/sticker2.jpg" alt="logo" style="width: 100%;">
</div>

    <!-- Load Header Here -->
    <div id="header-container"></div>
    <div class="stats-container">
        <div id="timer-display">Time: 0s</div>
    </div>
    
    <div class="controls">
        <select id="timer-select">
            <option value="120">2 min</option>
            <option value="60">1 min</option>
            <option value="40">40 sec</option>
        </select>
        
        <button id="start-button">Start</button>
    </div>

    <div class="input-container">
        <div id="background-text" class="background-text"></div>
        <textarea id="typing-input" class="input-box" disabled></textarea>
    </div>

    <!-- Footer Container -->
    <div id="footer-container"></div>
    <script>
        
         // Function to Load External HTML Files
         function loadComponent(elementId, filePath) {
            fetch(filePath)
                .then(response => response.text())
                .then(data => {
                    document.getElementById(elementId).innerHTML = data;
                })
                .catch(error => console.error('Error loading component:', error));
        }

        // Load header.html and footer.html
        loadComponent("header-container", "header.html");
        loadComponent("footer-container", "footer.html");

        // Footer Scroll Effect
        let lastScrollY = window.scrollY;
        
        window.addEventListener("scroll", function () {
            let footer = document.querySelector("footer");
            let currentScrollY = window.scrollY;

            if (currentScrollY > lastScrollY) {  
                // Show footer when scrolling down
                footer.style.opacity = "1";
            } else {  
                // Hide footer when scrolling up
                footer.style.opacity = "0";
            }

            lastScrollY = currentScrollY;
        });

        // Show footer after 2 seconds on page load
        setTimeout(() => {
            let footer = document.querySelector("footer");
            if (footer) {
                footer.style.opacity = "1";
            }
        }, 1000);

        function showHelp() {
            document.getElementById("helpImage").style.display = "block";
            document.getElementById("overlay").style.display = "block";
        }

        function hideHelp() {
            document.getElementById("helpImage").style.display = "none";
            document.getElementById("overlay").style.display = "none";
        }
        const paragraphs = [
    "The sun was setting behind the mountains, casting a golden glow across the valley. Birds chirped their final songs of the day, while a cool breeze rustled the leaves of ancient oak trees. It was a peaceful evening, the kind that made people stop and appreciate the beauty of nature. As the sky turned shades of pink and orange, a sense of calmness spread over the land.",
    "Technology has changed the way we live and interact with the world. From smartphones to artificial intelligence, innovations continue to shape our daily lives. People can communicate instantly across the globe, access unlimited knowledge, and automate tasks that once required hours of work. While technology brings convenience, it also raises questions about privacy, security, and human connection.",
    "A good book has the power to transport readers into different worlds. Whether it's a thrilling adventure, a heartwarming romance, or a thought-provoking mystery, stories have a way of captivating our minds. Reading allows people to explore new perspectives, learn about diverse cultures, and develop empathy. Books are not just pages with words; they are windows to imagination.",
    "Success is not always about talent or intelligence; perseverance plays a key role. Many great achievers have faced failure before reaching their goals. What sets them apart is their determination to keep going despite obstacles. Hard work, patience, and a positive mindset can turn challenges into opportunities. In the end, those who never give up are the ones who succeed.",
    "Music has the power to evoke deep emotions and memories. A single melody can transport someone back to a specific moment in time, bringing joy or nostalgia. From classical symphonies to modern pop songs, music unites people across cultures and generations. It speaks a universal language that words often fail to express.",
    "The ocean stretches endlessly, its waves crashing rhythmically against the shore. The salty breeze carries the scent of adventure, while seagulls call out in the distance. Walking along the beach, one can feel the grains of sand between their toes, a gentle reminder of natureâ€™s beauty and tranquility.",
    "Friendship is one of lifeâ€™s greatest treasures. True friends support and uplift each other, sharing both joy and sorrow. They stand by your side through thick and thin, offering encouragement and laughter. A strong friendship can withstand the test of time, creating lasting memories that shape our lives.",
    "Every morning brings a fresh start and new possibilities. The rising sun signals a chance to chase dreams, learn from yesterdayâ€™s mistakes, and embrace opportunities. Whether big or small, each day presents moments that shape our journey. The key is to approach life with gratitude and determination.",
    "Traveling opens the mind to new experiences and cultures. Exploring unfamiliar places allows people to step out of their comfort zones and see the world from a different perspective. From bustling cities to remote villages, every destination has a unique story to tell, enriching the travelerâ€™s soul with each journey.",
    "The sky at night is a breathtaking spectacle, dotted with countless stars. The vastness of the universe reminds us of how small we are in comparison. Gazing at the constellations, one canâ€™t help but wonder about the mysteries of space and the possibility of life beyond our planet.",
    "Kindness has the power to change the world. A simple act, like a smile or a helping hand, can brighten someoneâ€™s day. Kindness spreads like ripples in a pond, inspiring others to do the same. When people choose compassion over hatred, the world becomes a better place for everyone.",
    "Courage is not the absence of fear but the ability to move forward despite it. Life presents challenges that test our strength and resolve. Those who face their fears with bravery often discover new strengths within themselves. In the end, courage leads to growth and transformation.",
    "Time is a precious gift that should not be wasted. Each passing moment is an opportunity to learn, create, and love. While the past cannot be changed and the future is uncertain, the present moment is ours to cherish. Making the most of today leads to a fulfilling life.",
    "Laughter is one of the best remedies for stress and sorrow. A good laugh has the power to lighten the heart, strengthen bonds, and boost well-being. Whether shared with friends or found in lifeâ€™s funny moments, laughter reminds us not to take life too seriously.",
    "Dreams fuel ambition and inspire people to reach for the impossible. Those who dare to dream big often pave the way for innovation and change. While dreams require effort and perseverance, they hold the potential to transform lives and make the world a better place.",
    "Rain brings a sense of renewal and tranquility. The rhythmic drops hitting the ground create a soothing melody, washing away the dust of yesterday. After the storm passes, the fresh scent of earth fills the air, and the world seems alive with new beginnings.",
    "Learning is a lifelong journey that never truly ends. Knowledge expands horizons and empowers individuals to make informed decisions. Whether through books, experiences, or conversations, every lesson contributes to personal growth and wisdom.",
    "Animals bring joy and companionship to people's lives. Whether itâ€™s a loyal dog, a playful cat, or a singing bird, pets become beloved members of the family. Their unconditional love and affection create a bond that provides comfort and happiness.",
    "Nature has a way of healing and restoring the soul. A walk in the forest, a hike in the mountains, or simply sitting by a river can ease stress and bring peace. The beauty of the natural world serves as a reminder of the importance of preserving it for future generations.",
    "Hope is the light that guides people through difficult times. It provides strength to endure hardships and the belief that better days are ahead. Even in the darkest moments, hope keeps the spirit alive and fuels the courage to keep going.",
    "Creativity allows people to express themselves in unique and meaningful ways. Whether through art, music, writing, or innovation, creativity sparks inspiration and change. It has the power to transform the ordinary into something extraordinary.",
    "Family is the foundation of love and support. The bonds formed with family members create a sense of belonging and security. Though challenges may arise, the connection shared with loved ones remains one of lifeâ€™s most cherished treasures.",
    "Happiness is found in the simple moments of life. A warm cup of coffee on a rainy morning, a heartfelt conversation, or the laughter of childrenâ€”these are the moments that truly matter. True happiness comes from appreciating the present and embracing lifeâ€™s small joys.",
    "Patience is a virtue that leads to great rewards. In a fast-paced world, learning to wait and trust the process is a valuable skill. Good things take time, and those who practice patience often find success in the most unexpected ways.",
    "Resilience is the ability to rise after every fall. Life is filled with setbacks, but those who persevere through adversity emerge stronger. Challenges shape character and build resilience, proving that failure is not the end but a stepping stone to success.",
    "Love is the most powerful force in the world. It transcends boundaries, heals wounds, and brings people together. Whether romantic, familial, or platonic, love is the foundation of meaningful relationships and the key to a fulfilled life."
];

let selectedParagraph = "";
const backgroundText = document.getElementById("background-text");
const inputBox = document.getElementById("typing-input");
const timerDisplay = document.getElementById("timer-display");
const timerSelect = document.getElementById("timer-select");
const startButton = document.getElementById("start-button");

let startTime = null;
let totalTyped = 0;
let correctTyped = 0;
let countdown = 0;
let timer = null; // Keep only one timer declaration
let timeLeft = 10; // Default time (changeable)
let isRunning = false; // Track if timer is running



function getRandomParagraph() {
    return paragraphs[Math.floor(Math.random() * paragraphs.length)];
}

function updateBackgroundText() {
    let userText = inputBox.value;
    let formattedText = "";
    let cleanedUserText = userText.replace(/\s+/g, ''); // Remove spaces for comparison
    let cleanedParagraph = selectedParagraph.replace(/\s+/g, '');

    // â³ Start the timer ONLY when the user types the first character
    if (!startTime && cleanedUserText.length > 0) {
        startTime = new Date().getTime();
        if (!isRunning) {
            isRunning = true;
            startTimer();  // ðŸ”¥ Start the timer when the first character is typed
        }
    }

    let inputIndex = 0;
    for (let i = 0; i < selectedParagraph.length; i++) {
        if (selectedParagraph[i] === " ") {
            formattedText += " ";
        } else {
            if (inputIndex < cleanedUserText.length) {
                totalTyped++;
                if (cleanedUserText[inputIndex] === cleanedParagraph[inputIndex]) {
                    formattedText += `<span class="correct">${selectedParagraph[i]}</span>`;
                    correctTyped++;
                } else {
                    formattedText += `<span class="incorrect">${selectedParagraph[i]}</span>`;
                }
                inputIndex++;
            } else {
                formattedText += selectedParagraph[i];
            }
        }
    }

    backgroundText.innerHTML = formattedText;
    inputBox.setSelectionRange(userText.length, userText.length);

    // âœ… If user finishes typing before time runs out, stop the timer and show results
    if (cleanedUserText === cleanedParagraph) {
        clearInterval(timer);
        const currentTime = new Date().getTime();
        const timeTaken = startTime ? Math.floor((currentTime - startTime) / 1000) : 0;
        endTest(true, timeTaken);
    }
}

// Preload the beep sound
const beep = new Audio("beep3.mp3");
beep.load();


timerSelect.addEventListener("change", function () {
    let newTime = parseInt(timerSelect.value);

    if (!isRunning) {
        // If the test has not started, update countdown
        countdown = newTime;
        timerDisplay.innerText = `Time: ${countdown}s`;
    } else {
        // âš ï¸ Do NOT restart the timer if the test is running!
        let timeElapsed = parseInt(timerSelect.getAttribute("data-start-time")) || 0;
        let remainingTime = newTime - timeElapsed;
        
        if (remainingTime > 0) {
            countdown = remainingTime;
            timerDisplay.innerText = `Time: ${countdown}s`;
        }
    }
});


function startTimer() {
    if (timer) clearInterval(timer); // ðŸš€ Prevent multiple timers
    timer = setInterval(() => {
        countdown--;
        timerDisplay.innerText = `Time: ${countdown}s`;

        if (countdown === 4) {
            beep.currentTime = 0;
            beep.play().catch(error => console.error("Audio play failed:", error));
        }

        if (countdown <= 0) {
            clearInterval(timer);
            endTest();
        }
    }, 1000);
}

function startTest() {
    selectedParagraph = getRandomParagraph();
    backgroundText.innerHTML = selectedParagraph;

    countdown = parseInt(timerSelect.value);
    timerDisplay.innerText = `Time: ${countdown}s`;
    inputBox.value = "";
    totalTyped = 0;
    correctTyped = 0;
    startTime = null;
    inputBox.disabled = false;
    inputBox.focus();
    updateBackgroundText();

    startButton.disabled = true;
    isRunning = false; // Make sure typing starts the timer, not button press
}
function calculateAccuracy() {
    let userText = inputBox.value;
    let totalTyped = userText.length;
    let correctTyped = 0;

    for (let i = 0; i < totalTyped; i++) {
        if (userText[i] === selectedParagraph[i]) {
            correctTyped++;
        }
    }

    let accuracy = totalTyped > 0 ? (correctTyped / totalTyped) * 100 : 0;
    return accuracy.toFixed(2); // Limit to 2 decimal places
}


function endTest(completed = false, timeTaken = null) {
    inputBox.disabled = true;
    clearInterval(timer);

    const currentTime = new Date().getTime();
    const elapsedTime = startTime ? (currentTime - startTime) / 60000 : 0; // Convert ms to minutes
    const wordCount = inputBox.value.trim().split(/\s+/).length;
    const wpm = elapsedTime > 0 ? Math.round(wordCount / elapsedTime) : 0;
    const accuracy = totalTyped > 0 ? Math.round((correctTyped / totalTyped) * 100) : 100;

    // **Fix:** Use the correct time taken when user finishes early
    const displayTimeTaken = completed ? `${timeTaken}s` : `${timerSelect.value}s`;

    // Play beep sound when test ends
    beep.currentTime = 0;
    beep.play().catch(error => console.error("Beep failed to play:", error));

    const popup = document.createElement("div");
    popup.id = "popup-message";
    popup.innerHTML = `
        <div class="popup-content">
            <h2>${completed ? "Congratulations! You finished typing!" : "Time's up!"}</h2>
            <p><strong>WPM:</strong> ${wpm}</p>
            <p><strong>Accuracy:</strong> ${accuracy}%</p>
            <p><strong>Time Taken:</strong> ${displayTimeTaken}</p>
            <button id="close-popup">OK</button>
        </div>
    `;

    document.body.appendChild(popup);

    document.getElementById("close-popup").addEventListener("click", () => {
        popup.remove();
        startButton.disabled = false;
    });

    startButton.disabled = false;
}


inputBox.addEventListener("input", updateBackgroundText);
startButton.addEventListener("click", startTest);

window.onload = () => {
    selectedParagraph = getRandomParagraph();
    backgroundText.innerHTML = selectedParagraph;
    inputBox.focus();
};
 
    </script>

</body>
</html>